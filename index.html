<!doctype html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#1e40af" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="×—×–×•×Ÿ ×™×•×¡×£" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    
    <!-- Force HTTPS Redirect -->
    <script>
      if (window.location.protocol === 'http:' && window.location.hostname !== 'localhost') {
        window.location.href = window.location.href.replace('http:', 'https:');
      }
    </script>
    
    <!-- Primary Meta Tags -->
    <title>×‘×™×ª ×”××“×¨×© "×—×–×•×Ÿ ×™×•×¡×£" - ×©×™×›×•×Ÿ ×’' ×‘× ×™ ×‘×¨×§</title>
    <meta name="title" content="×‘×™×ª ×”××“×¨×© ×—×–×•×Ÿ ×™×•×¡×£ - ×©×™×›×•×Ÿ ×’' ×‘× ×™ ×‘×¨×§" />
    <meta name="description" content="×‘×™×ª ×”××“×¨×© ×—×–×•×Ÿ ×™×•×¡×£ - ××¨×›×– ×ª×•×¨× ×™ ×‘×©×™×›×•×Ÿ ×’' ×•×”×¡×‘×™×‘×”, ×‘×¢×œ ×”×ª× ×™× 26 ×‘× ×™ ×‘×¨×§. ×©×™×¢×•×¨×™ ×ª×•×¨×”, ×ª×¤×™×œ×•×ª ×•×¤×¢×™×œ×•×™×•×ª ×§×”×™×œ×ª×™×•×ª." />
    <meta name="keywords" content="×‘×™×ª ××“×¨×©, ×—×–×•×Ÿ ×™×•×¡×£, ×©×™×›×•×Ÿ ×’, ×‘× ×™ ×‘×¨×§, ×ª×•×¨×”, ×ª×¤×™×œ×”, ×©×™×¢×•×¨×™×, ×§×”×™×œ×”, ×‘×¢×œ ×”×ª× ×™×" />
    <meta name="author" content="×‘×™×ª ×”××“×¨×© ×—×–×•×Ÿ ×™×•×¡×£" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://chazonyosef.netlify.app/" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://chazonyosef.netlify.app/" />
    <meta property="og:title" content="×‘×™×ª ×”××“×¨×© ×—×–×•×Ÿ ×™×•×¡×£ - ×©×™×›×•×Ÿ ×’' ×‘× ×™ ×‘×¨×§" />
    <meta property="og:description" content="×‘×™×ª ×”××“×¨×© ×—×–×•×Ÿ ×™×•×¡×£ - ××¨×›×– ×ª×•×¨× ×™ ×‘×©×™×›×•×Ÿ ×’' ×•×”×¡×‘×™×‘×”, ×‘×¢×œ ×”×ª× ×™× 26 ×‘× ×™ ×‘×¨×§" />
    <meta property="og:image" content="https://chazonyosef.netlify.app/logo.png" />
    <meta property="og:locale" content="he_IL" />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://chazonyosef.netlify.app/" />
    <meta property="twitter:title" content="×‘×™×ª ×”××“×¨×© ×—×–×•×Ÿ ×™×•×¡×£ - ×©×™×›×•×Ÿ ×’' ×‘× ×™ ×‘×¨×§" />
    <meta property="twitter:description" content="×‘×™×ª ×”××“×¨×© ×—×–×•×Ÿ ×™×•×¡×£ - ××¨×›×– ×ª×•×¨× ×™ ×‘×©×™×›×•×Ÿ ×’' ×•×”×¡×‘×™×‘×”, ×‘×¢×œ ×”×ª× ×™× 26 ×‘× ×™ ×‘×¨×§" />
    <meta property="twitter:image" content="https://chazonyosef.netlify.app/logo.png" />
    
    <!-- Geo Tags -->
    <meta name="geo.region" content="IL" />
    <meta name="geo.placename" content="×‘× ×™ ×‘×¨×§" />
    <meta name="geo.position" content="32.0809;34.8338" />
    <meta name="ICBM" content="32.0809, 34.8338" />
    
    <!-- Preload Critical Images -->
    <link rel="preload" href="/logo.png" as="image" type="image/png">
    
    <!-- Google Fonts - Hebrew Support -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&family=Assistant:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    
    <!-- Preload Colors from localStorage to prevent flash -->
    <script>
      (function() {
        try {
          const saved = localStorage.getItem('siteSettings');
          if (saved) {
            const settings = JSON.parse(saved);
            if (settings.colors) {
              const root = document.documentElement;
              
              // Helper function to convert HEX to RGB string
              function hexToRgb(hex) {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? {
                  r: parseInt(result[1], 16),
                  g: parseInt(result[2], 16),
                  b: parseInt(result[3], 16)
                } : null;
              }
              
              function hexToRgbString(hex) {
                const rgb = hexToRgb(hex);
                return rgb ? `${rgb.r} ${rgb.g} ${rgb.b}` : '0 0 0';
              }
              
              function rgbToHex(r, g, b) {
                return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
              }
              
              // Generate shades
              function generateShades(baseColor) {
                const rgb = hexToRgb(baseColor);
                if (!rgb) return {};
                
                const shades = {};
                
                // Lighter shades
                const lighterSteps = [
                  { key: '50', mix: 0.95 },
                  { key: '100', mix: 0.9 },
                  { key: '200', mix: 0.75 },
                  { key: '300', mix: 0.6 },
                  { key: '400', mix: 0.3 }
                ];
                
                lighterSteps.forEach(({ key, mix }) => {
                  const r = Math.round(rgb.r + (255 - rgb.r) * mix);
                  const g = Math.round(rgb.g + (255 - rgb.g) * mix);
                  const b = Math.round(rgb.b + (255 - rgb.b) * mix);
                  shades[key] = rgbToHex(r, g, b);
                });
                
                shades['500'] = baseColor;
                
                // Darker shades
                const darkerSteps = [
                  { key: '600', mix: 0.2 },
                  { key: '700', mix: 0.4 },
                  { key: '800', mix: 0.6 },
                  { key: '900', mix: 0.8 }
                ];
                
                darkerSteps.forEach(({ key, mix }) => {
                  const r = Math.round(rgb.r * (1 - mix));
                  const g = Math.round(rgb.g * (1 - mix));
                  const b = Math.round(rgb.b * (1 - mix));
                  shades[key] = rgbToHex(r, g, b);
                });
                
                return shades;
              }
              
              // Apply colors immediately
              if (settings.colors.primary) {
                const primaryShades = generateShades(settings.colors.primary);
                Object.entries(primaryShades).forEach(([shade, color]) => {
                  root.style.setProperty(`--color-primary-${shade}`, hexToRgbString(color));
                });
                root.style.setProperty('--color-primary', hexToRgbString(settings.colors.primary));
              }
              
              if (settings.colors.secondary) {
                const secondaryShades = generateShades(settings.colors.secondary);
                Object.entries(secondaryShades).forEach(([shade, color]) => {
                  root.style.setProperty(`--color-secondary-${shade}`, hexToRgbString(color));
                });
                root.style.setProperty('--color-secondary', hexToRgbString(settings.colors.secondary));
              }
              
              if (settings.colors.accent) {
                const accentShades = generateShades(settings.colors.accent);
                Object.entries(accentShades).forEach(([shade, color]) => {
                  root.style.setProperty(`--color-accent-${shade}`, hexToRgbString(color));
                });
                root.style.setProperty('--color-accent', hexToRgbString(settings.colors.accent));
              }
              
              console.log('ğŸ¨ Colors preloaded from localStorage');
            }
            
            // Preload gradient (sync, immediate)
            if (settings.gradient) {
              const root = document.documentElement;
              
              // Support both old format (startColor/endColor) and new format (colors array)
              let colors = settings.gradient.colors;
              if (!colors && settings.gradient.startColor && settings.gradient.endColor) {
                colors = [settings.gradient.startColor, settings.gradient.endColor];
              }
              if (!colors) {
                colors = ['#1e3a8a', '#4c1d95', '#7c3aed'];
              }
              
              root.style.setProperty('--gradient-colors', colors.join(', '));
              root.style.setProperty('--gradient-direction', settings.gradient.direction || 'to right');
              
              if (settings.gradient.enabled && document.body) {
                document.body.classList.add('gradient-enabled');
                document.body.style.background = `linear-gradient(${settings.gradient.direction || 'to right'}, ${colors.join(', ')})`;
                document.body.style.backgroundAttachment = 'fixed';
                console.log('ğŸŒˆ Gradient preloaded from localStorage');
              }
            }
            
            // Preload button gradient (sync, immediate)
            if (settings.buttonGradient) {
              const root = document.documentElement;
              let buttonColors = settings.buttonGradient.colors || ['#4f46e5', '#7c3aed'];
              
              root.style.setProperty('--button-gradient-colors', buttonColors.join(', '));
              root.style.setProperty('--button-gradient-direction', settings.buttonGradient.direction || 'to right');
              
              if (settings.buttonGradient.enabled && document.body) {
                document.body.classList.add('button-gradient-enabled');
                console.log('ğŸ¨ Button gradient preloaded from localStorage');
              }
            }
            
            // Preload font (async, non-blocking)
            if (settings.font) {
              const fontMap = {
                'Assistant': 'Assistant, sans-serif',
                'Rubik': 'Rubik, sans-serif',
                'Heebo': 'Heebo, sans-serif',
                'Varela Round': 'Varela Round, sans-serif',
                'Alef': 'Alef, sans-serif',
                'Open Sans': 'Open Sans, sans-serif',
                'Secular One': 'Secular One, sans-serif',
                'Arimo': 'Arimo, sans-serif',
                'Frank Ruhl Libre': 'Frank Ruhl Libre, serif',
                'Tinos': 'Tinos, serif'
              };
              
              const googleFontMap = {
                'Assistant': 'Assistant:wght@300;400;500;600;700;800',
                'Rubik': 'Rubik:wght@300;400;500;600;700;800;900',
                'Heebo': 'Heebo:wght@100;200;300;400;500;600;700;800;900',
                'Varela Round': 'Varela+Round',
                'Alef': 'Alef:wght@400;700',
                'Open Sans': 'Open+Sans:wght@300;400;500;600;700;800',
                'Secular One': 'Secular+One',
                'Arimo': 'Arimo:wght@400;500;600;700',
                'Frank Ruhl Libre': 'Frank+Ruhl+Libre:wght@300;400;500;700;900',
                'Tinos': 'Tinos:wght@400;700'
              };
              
              const fontValue = fontMap[settings.font];
              const googleFont = googleFontMap[settings.font];
              
              if (fontValue && googleFont) {
                // Apply font CSS variable immediately
                document.documentElement.style.setProperty('--font-family', fontValue);
                
                // Load Google Font asynchronously (non-blocking)
                setTimeout(function() {
                  const existingLink = document.getElementById('preload-font-link');
                  if (existingLink) {
                    existingLink.remove();
                  }
                  
                  const link = document.createElement('link');
                  link.id = 'preload-font-link';
                  link.rel = 'stylesheet';
                  link.href = `https://fonts.googleapis.com/css2?family=${googleFont}&display=swap`;
                  link.media = 'print';
                  link.onload = function() { this.media = 'all'; };
                  document.head.appendChild(link);
                  
                  console.log('ğŸ”¤ Font preloaded from localStorage:', settings.font);
                }, 0);
              }
            }
          }
        } catch (error) {
          console.error('Error preloading settings:', error);
        }
      })();
    </script>
    
    <!-- Structured Data (Schema.org) for Google -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Synagogue",
      "name": "×‘×™×ª ×”××“×¨×© ×—×–×•×Ÿ ×™×•×¡×£",
      "alternateName": "Beit Hamidrash Chazon Yosef",
      "description": "×‘×™×ª ××“×¨×© ×•××¨×›×– ×ª×•×¨× ×™ ×‘×©×™×›×•×Ÿ ×’' ×•×”×¡×‘×™×‘×”, ×‘× ×™ ×‘×¨×§",
      "url": "https://chazonyosef.netlify.app",
      "logo": "https://chazonyosef.netlify.app/logo.png",
      "image": "https://chazonyosef.netlify.app/logo.png",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "×‘×¢×œ ×”×ª× ×™× 26",
        "addressLocality": "×‘× ×™ ×‘×¨×§",
        "addressRegion": "×ª×œ ××‘×™×‘",
        "postalCode": "5126001",
        "addressCountry": "IL"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": "32.0809",
        "longitude": "34.8338"
      },
      "telephone": "+972-XX-XXX-XXXX",
      "openingHoursSpecification": [
        {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday"],
          "opens": "06:00",
          "closes": "23:00"
        }
      ],
      "sameAs": [
        "https://chazonyosef.netlify.app"
      ]
    }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    
    <!-- Service Worker Registration -->
    <script>
      if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/service-worker.js')
            .then(registration => {
              console.log('âœ… Service Worker registered successfully:', registration.scope);
              
              // Check for updates periodically
              setInterval(() => {
                registration.update();
              }, 60000); // Check every minute
            })
            .catch(error => {
              console.error('âŒ Service Worker registration failed:', error);
            });
        });
      } else if ('serviceWorker' in navigator) {
        console.log('â„¹ï¸ PWA features available only in production (HTTPS).');
      }
    </script>
    
    <script>
      // Netlify Identity redirect handling
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin";
            });
          }
        });
      }
    </script>
  </body>
</html>
